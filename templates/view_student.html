{% extends "base.html" %}
{% block content %}
<h2>ðŸ“Š Dashboard - {{ student.name }} ({{ student.roll }})</h2>

<section class="grid">

  <!-- Attendance Card -->
  <div class="card">
    <h3>Attendance</h3>
    <p><strong>{{ present_days }}</strong> / {{ total_days }} days</p>
    <p>Percentage: 
      <span class="badge {{ att_status }}">{{ attendance_pct }}%</span>
    </p>
    <h4>Recent History</h4>
    <table>
      <tr><th>Date</th><th>Status</th></tr>
      {% for r in history %}
      <tr><td>{{ r.date }}</td><td>{{ r.status }}</td></tr>
      {% endfor %}
    </table>
  </div>

  <!-- Assignments Card -->
  <div class="card">
    <h3>Assignments</h3>
    <table>
      <tr><th>ID</th><th>Title</th><th>Max</th><th>Weight</th><th>Marks</th><th>Due</th><th>Submit</th></tr>
      {% for a in assignments %}
      <tr>
        <td>{{ a.assignment_id }}</td>
        <td>{{ a.title }}</td>
        <td>{{ a.max_marks }}</td>
        <td>{{ a.weight }}</td>
        <td>{{ a.marks }}</td>
        <td data-duedate="{{ a.due_date }}">{{ a.due_date }}</td>
        <td>
          {% if a.submitted %}
            âœ… Submitted
          {% else %}
            <a href="{{ url_for('submit_assignment', assignment_id=a.assignment_id) }}">Submit</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
    <p>Overall Performance: 
      <span class="badge {{ perf_status }}">{{ overall_perf }}%</span>
    </p>
  </div>

  <!-- Meetings Card -->
  <div class="card">
    <h3>Upcoming Meetings</h3>
    <table>
      <tr><th>Title</th><th>Date</th><th>Time</th><th>Starts</th><th>Action</th></tr>
      {% for m in meetings %}
      <tr>
        <td>{{ m.title }}</td>
        <td>{{ m.date }}</td>
        <td>{{ m.time }}</td>
        <td data-meetingtime="{{ m.date }}T{{ m.time }}"></td>
        <td>
          <form action="{{ url_for('attend_meeting', meeting_id=m.meeting_id) }}" method="post" style="display:inline">
            <input name="roll" placeholder="Enter Roll" required>
            <button type="submit">Attend</button>
          </form>
          {% if m.link %}
          <a href="{{ m.link }}" target="_blank">Join</a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>

</section>

{% endblock %}

<script>
function joinAndMarkAttendance(form, meetingLink) {
  window.open(meetingLink, '_blank'); // Open meeting link in new tab
  // Allow form to submit and mark attendance
  return true;
}
</script>
